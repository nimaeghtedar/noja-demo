<!DOCTYPE html>
<html lang="fa"
      dir="rtl">

<head>
  <base href="/">
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0">
  <title>نوژا | آدرس تحویل</title>

  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" />
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
  <link href="https://fonts.googleapis.com/css2?family=Lalezar&display=swap"
        rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css"
        rel="stylesheet" />
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet"
        href="assets/css/style.css" />
  <link rel="stylesheet"
        href="assets/css/user.css" />


</head>

<body>
  <!-- Header -->
  <header class="backdrop-blur py-3 fixed-top">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center gap-3">
          <button class="btn-icon"
                  onclick="window.location.href='index.html'">
            <i class="bi bi-arrow-right"></i>
          </button>
          <h4 class="mb-0">آدرس تحویل</h4>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="container mt-5 pt-5">
    <!-- Checkout Steps -->
    <div class="dashboard-card mb-4">
      <div class="d-flex justify-content-between align-items-center">
        <div class="step-item active">
          <div class="step-icon">
            <i class="bi bi-cart-check"></i>
          </div>
          <span>سبد خرید</span>
        </div>
        <div class="step-line"></div>
        <div class="step-item current">
          <div class="step-icon">
            <i class="bi bi-geo-alt"></i>
          </div>
          <span>آدرس تحویل</span>
        </div>
        <div class="step-line"></div>
        <div class="step-item">
          <div class="step-icon">
            <i class="bi bi-credit-card"></i>
          </div>
          <span>پرداخت</span>
        </div>
      </div>
    </div>

    <!-- Saved Addresses -->
    <div class="dashboard-card">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h5 class="mb-0">آدرس‌های ذخیره شده</h5>
        <button class="btn btn-link text-accent-primary p-0"
                onclick="showNewAddressForm()">
          <i class="bi bi-plus-lg me-2"></i>
          افزودن آدرس جدید
        </button>
      </div>

      <div class="address-card selected">
        <div class="address-badge">پیش‌فرض</div>
        <div class="address-actions">
          <button class="btn btn-sm btn-link"
                  onclick="editAddress(1)">
            <i class="bi bi-pencil"></i>
          </button>
        </div>
        <h6 class="mb-2">منزل</h6>
        <p class="text-secondary mb-1">
          تهران، خیابان ولیعصر، کوچه مهر، پلاک ۱۲
        </p>
        <small class="text-secondary d-block">کد پستی: ۱۲۳۴۵۶۷۸۹۰</small>
      </div>

      <div class="address-card">
        <div class="address-actions">
          <button class="btn btn-sm btn-link"
                  onclick="editAddress(2)">
            <i class="bi bi-pencil"></i>
          </button>
        </div>
        <h6 class="mb-2">محل کار</h6>
        <p class="text-secondary mb-1">
          تهران، سعادت‌آباد، خیابان علامه شمالی، پلاک ۴۵
        </p>
        <small class="text-secondary d-block">کد پستی: ۹۸۷۶۵۴۳۲۱۰</small>
      </div>
    </div>

    <!-- New Address Form -->
    <div class="dashboard-card d-none"
         id="newAddressForm">
      <h5 class="mb-4">افزودن آدرس جدید</h5>

      <form id="addressForm">
        <div class="row g-3 mb-3">
          <div class="col-md-6">
            <label class="form-label">عنوان آدرس</label>
            <input type="text"
                   class="form-control"
                   placeholder="مثال: خانه، محل کار"
                   required />
          </div>
          <div class="col-md-6">
            <label class="form-label">شماره تماس</label>
            <input type="tel"
                   class="form-control"
                   placeholder="۰۹۱۲۳۴۵۶۷۸۹"
                   required />
          </div>
        </div>

        <div class="row g-3 mb-3">
          <div class="col-md-6">
            <label class="form-label">استان</label>
            <select class="form-select"
                    required>
              <option value="">انتخاب کنید</option>
              <option>تهران</option>
              <option>اصفهان</option>
              <option>شیراز</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label">شهر</label>
            <select class="form-select"
                    required>
              <option value="">انتخاب کنید</option>
              <option>تهران</option>
              <option>ری</option>
              <option>شمیرانات</option>
            </select>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">آدرس کامل</label>
          <textarea class="form-control"
                    rows="3"
                    required></textarea>
        </div>

        <div class="row g-3 mb-3">
          <div class="col-md-6">
            <label class="form-label">پلاک</label>
            <input type="text"
                   class="form-control"
                   required />
          </div>
          <div class="col-md-6">
            <label class="form-label">واحد</label>
            <input type="text"
                   class="form-control" />
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">کد پستی</label>
          <input type="text"
                 class="form-control"
                 placeholder="کد پستی ۱۰ رقمی"
                 required />
        </div>

        <div class="mb-3">
          <label class="form-label">موقعیت روی نقشه</label>
          <div class="map-container"
               id="map"></div>
        </div>

        <div class="form-check mb-4">
          <input class="form-check-input"
                 type="checkbox"
                 id="defaultAddress" />
          <label class="form-check-label text-secondary"
                 for="defaultAddress">
            تنظیم به عنوان آدرس پیش‌فرض
          </label>
        </div>

        <div class="d-flex gap-2">
          <button type="submit"
                  class="action-btn">ثبت آدرس</button>
          <button type="button"
                  class="action-btn outline"
                  onclick="hideNewAddressForm()">
            انصراف
          </button>
        </div>
      </form>
    </div>

    <!-- Summary and Continue -->
    <div class="dashboard-card">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h6 class="mb-1">مبلغ قابل پرداخت</h6>
          <div class="text-secondary">با احتساب مالیات و هزینه ارسال</div>
        </div>
        <div class="text-start">
          <div class="fs-5 mb-1">۵,۲۹۲,۲۰۰ تومان</div>
          <small class="text-secondary">شامل ۹٪ مالیات</small>
        </div>
      </div>

      <div class="d-grid gap-2">
        <button class="action-btn"
                onclick="window.location.href='cart/payment.html'">
          ادامه خرید
          <i class="bi bi-arrow-left me-2"></i>
        </button>
        <button class="action-btn outline"
                onclick="window.location.href='cart/cart.html'">
          بازگشت به سبد خرید
        </button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // Address Selection
    function selectAddress(element) {
      document.querySelectorAll('.quick-action').forEach((card) => {
        card.classList.remove('selected');
      });
      element.classList.add('selected');
    }

    // New Address Form
    function showNewAddressForm() {
      document.getElementById('newAddressForm').classList.remove('d-none');
      initMap();
    }

    function hideNewAddressForm() {
      document.getElementById('newAddressForm').classList.add('d-none');
    }

    // Map Initialization
    function initMap() {
      const map = L.map('map').setView([35.6892, 51.389], 13);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(
        map
      );

      let marker;

      // Map click event handler
      map.on('click', function (e) {
        if (marker) {
          marker.setLatLng(e.latlng);
        } else {
          marker = L.marker(e.latlng).addTo(map);
        }
      });

      // Try to get user's location
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          map.setView([lat, lng], 15);

          if (!marker) {
            marker = L.marker([lat, lng]).addTo(map);
          } else {
            marker.setLatLng([lat, lng]);
          }
        });
      }
    }

    // Edit Address
    function editAddress(addressId) {
      showNewAddressForm();
      // In a real app, would populate form with address details
      console.log(`Editing address ${addressId}`);
    }

    // Form Submission
    document
      .getElementById('addressForm')
      ?.addEventListener('submit', function (e) {
        e.preventDefault();
        // In a real app, would save address to backend
        hideNewAddressForm();
        showNotification('آدرس جدید با موفقیت ثبت شد');
      });

    // Utilities
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'dashboard-card position-fixed bottom-0 end-0 m-3';
      notification.innerHTML = message;
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 3000);
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function () {
      // If map is visible on load, initialize it
      if (
        document.getElementById('newAddressForm').style.display !== 'none'
      ) {
        initMap();
      }
    });
  </script>
</body>

</html>